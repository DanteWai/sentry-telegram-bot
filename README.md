# Оповещение об ошибках в sentry через telegram

Проект построен на веб хуках. Один для sentry, один для telegram

Функционал телеграмм бота:
- Авторизация через email, происходит отправка кода на введенную почту и связь с этой почтой в sentry
- Авторизация через предоставленный код доступа к проекту
- Создание кода доступа
- Отправка сообщений об ошибках привязанным пользователям

Стек:
- PHP 7.4|8.*
- SqlLite3
- Redis

Развертка:
1. ```composer install```
2. Создать SqlLite базу в корне проекта (Название базы должно совпадать с названием в файле окружения)
3. Создать и настроить файл .env
4. Импортировать таблицы 
```
sqlite3 ./telegramDB.db
.read ./Database/database.sql
.exit
```
5. ```php initial_commands.php```

Переменные окружения(.env):
- APP_ENV - Переменная окружения (development|production|test)
- DATABASE_NAME - Название базы данных, например "test.db"
- TELEGRAM_SENTRY_BOT_TOKEN - Токен бота телеграм, который будет рассылать уведомления
- TELEGRAM_WEBHOOK_URL - url на который будут приходить сообщения из телеграм
- TELEGRAM_SUPER_ADMIN_CHAT_ID - Идентификатор админа (можно указать через запятую несколько)
- TELEGRAM_TEST_CHAT_ID - Идентификатор тестового чата


Админ команды (могут вводит пользователи чей ид присутствует в переменной окружения TELEGRAM_SUPER_ADMIN_CHAT_ID):
/create_auth_key_for_project - позволяет создать авторизационный ключ для подписки на оповещения конкретного проекта


Запуск тестов
```
vendor\bin\phpunit tests
```

Локальная разработка
php -S localhost:8000 Локальный веб сервер
ngrok http 8000 Доступ по внешнему адресу (для вебхука)
